<!doctype html>
<html>
	<head>
		<title>Fonts - Dezynor</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">
		<link rel="stylesheet" href="includes/styles.css">
		<script src="includes/indexeddb.js"></script>
		<script src="includes/common.js"></script>
		<script>

			window.onload = async function() {
				await delay(500);
				loadFonts();
			}

			function addFont() {
				let font_name = document.getElementById("font_name").value.trim();
				let font_location = document.getElementById("font_location").value;
				if (font_name.length < 1) return;
				
				idbGetItem("dezynor_settings", "fonts").then(function(result) {
					
					let fonts = result;
					let index = fonts.indexOf(font_name + "|" + font_location);
					if (index > -1) {
						alert("A font with the name '" + font_name + "' already exists.");
						document.getElementById("font_name").value = "";
						document.getElementById("font_name").focus();
						return;
					} else {
						fonts.push(font_name + "|" + font_location);
					}
					idbPutItem("dezynor_settings", {setting_key:"fonts", value:fonts});
					document.getElementById("font_name").value = "";
					document.getElementById("font_name").focus();
					showMessage("'" + font_name + "' added", "Green");
					loadFonts();
					
				});

			}

			async function loadFonts() {
				
				idbGetItem("dezynor_settings", "fonts").then(function(result) {
					let fonts = result;
					fonts.sort();
					let fonts_html = "";
					for (let i = 0; i < fonts.length; i++) {
						let font_name = fonts[i].split("|")[0];
						let font_location = fonts[i].split("|")[1];
						if (font_location == "Google") {
							font_location = " <span class='google'>(" + font_location + ")</span>";
						} else {
							font_location = " <span class='installed'>(" + font_location + ")</span>";
						}
						
						fonts_html = fonts_html + "<div><span title='Delete Font' class='delete' onclick=\"deleteFont('" + fonts[i] + "');\">" + "x</span> " + font_name + font_location + "</div>";
					}
					document.getElementById("fonts").innerHTML = fonts_html;
					document.getElementById("font_name").focus();
				});
			}

			function deleteFont(font_name) {
				if (font_name == "Anton|Google") {
					alert("The 'Anton' font can not be deleted.");
					return;
				}

				idbGetItem("dezynor_settings", "fonts").then(function(result) {
					let fonts = result;
					let index = fonts.indexOf(font_name);
					if (index > -1) {
						fonts.splice(index, 1);
						showMessage("'" + font_name + "' deleted successfully", "Red");
					} else {
						alert("'" + font_name + "' does not exist");
						return;
					}
					idbPutItem("dezynor_settings", {setting_key:"fonts", value:fonts});
					loadFonts();
					document.getElementById("font_name").focus();
				});
				
			}
		</script>
		<style>

			#fonts {
				font-size:120%;		
				line-height:170%;
				padding-bottom:50px;
			}

			#fonts .google {
				font-size:80%;
				color:blue;
			}

			#fonts .installed {
				font-size:80%;
				color:forestgreen;
			}

			.delete {
				cursor:pointer;
				padding-right:10px;
				color:red;
			}
		
		</style>
	</head>
	<body>
		<script>writeHeader();</script>
		<main>
			<div class="pad20">
				<input type="text" id="font_name" placeholder="Font name" class="mnw200 pad10"> 
				<select id="font_location" class="mnw200 pad10">
					<option>Installed</option>
					<option>Google</option>
				</select>
				<input type="button" value="Add new font" class="pad10" onclick="addFont();">
			</div>
			<h1 class="padleft20">Fonts</h1>
			<div id="fonts" class="padleft50"></div>
		</main>
	</body>
</html>
