<!doctype html>
<html>
	<head>
		<title>Settings - Dezynor</title>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta charset="utf-8">
		<link rel="stylesheet" href="includes/styles.css?v=20220722">
		<script src="includes/indexeddb.js?v=20220801"></script>
		<script src="includes/common.js?v=20220801"></script>
		<script>
			window.onload = async function() {
				await delay(500);
				loadSettings();
			}

			async function saveSettings() {

				let max_upload_width = document.getElementById("max_upload_width").value;
				let max_upload_height = document.getElementById("max_upload_height").value;
				await idbPutItem("dezynor_settings", {setting_key:"max_upload_width", value:max_upload_width});
				await idbPutItem("dezynor_settings", {setting_key:"max_upload_height", value:max_upload_height});

				if (document.getElementById("show_background_images").checked) {
					localStorage.setItem("show_background_images", "");
				} else {
					localStorage.removeItem("show_background_images");
				}

				showMessage("Saved", "DarkGreen");
			}

			function loadSettings() {
				idbGetItem("dezynor_settings", "max_upload_width").then(function(result) {
					document.getElementById("max_upload_width").value = result;
				});
				idbGetItem("dezynor_settings", "max_upload_height").then(function(result) {
					document.getElementById("max_upload_height").value = result;
				});

				if ("show_background_images" in localStorage) document.getElementById("show_background_images").checked = true;
			}
			
		</script>
	</head>
	<body>
		<script>writeHeader();</script>
		<main>
			<div class="padleft50">
			</div>
			
			<div id="settings" class="pad50 mxw500">
				<div id="space_usage"></div>
				<table>
					<tr>
						<td class="padright10"><img src="images/icon_caution.png"></td>
						<td>Dezynor uses browser's IndexedDB for the purpose of saving all designs and settings. If you use some performance
							and tunning application such as <strong>CCleaner</strong>, please make sure it does not wipe up the IndexedDB.
						</td>
					</tr>
				</table>
				<hr>
				<h1>Settings</h1>
				<form onsubmit="event.preventDefault();saveSettings();">
				<table>
					<tr>
						<td>Max upload width</td>
						<td>
							<input type="number" id="max_upload_width" value="1000" min="200" title="Max Upload Width" required> 
						</td>
					</tr>
					<tr>
						<td>Max upload height</td>
						<td>
							<input type="number" id="max_upload_height" value="1000" min="200" title="Max Upload Height" required>
						</td>
					</tr>
					<tr>
						<td>Show background images</td>
						<td>
							<input type="checkbox" id="show_background_images">
						</td>
					</tr>
					
				</table>
				<p>
					<input type="submit" value="Save">
				</p>
				</form>
			</div>
		</main>
	</body>
</html>
